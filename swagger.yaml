swagger: '2.0'
info:
  title: "Mechanic Shop API"
  description: "A comprehensive API for managing a mechanic shop including customers, mechanics, service tickets, and inventory"
  version: "1.0.0"
host: "mechanic-api-copy-with-testing-and.onrender.com"
schemes:
  - "https"
consumes:
  - "application/json"
produces:
  - "application/json"

securityDefinitions:
  bearerAuth:
    type: apiKey
    name: Authorization
    in: header
    description: "JWT Authorization header using the Bearer scheme. Example: 'Bearer {token}'"

paths:
  # Customer Endpoints
  /customers/login:
    post:
      tags:
        - Customers
      summary: "Customer login endpoint (generates token)"
      description: "Validates customer credentials, generates and returns a customer specific token."
      parameters:
        - in: "body"
          name: "body"
          description: "Login Credentials"
          required: true
          schema:
            $ref: "#/definitions/LoginCredentials"
      responses:
        200:
          description: "Login successful"
          schema:
            $ref: "#/definitions/LoginResponse"
          examples:
            application/json:
              message: "Login successful"
              token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
              customer:
                id: 1
                first_name: "John"
                last_name: "Doe"
                email: "john.doe@email.com"
                phone: "555-1234"
                address: "123 Main St"
        400:
          description: "Invalid input"
          schema:
            $ref: "#/definitions/ErrorResponse"
        401:
          description: "Invalid credentials"
          schema:
            $ref: "#/definitions/ErrorResponse"

  /customers:
    post:
      tags:
        - Customers
      summary: "Endpoint to create/register a new customer."
      description: "Endpoint to create a new customer in the Mechanic Shop system, emails must be unique."
      parameters:
        - in: "body"
          name: "body"
          description: "Information required to create a new Customer."
          required: true
          schema:
            $ref: "#/definitions/CreateCustomerPayload"
      responses:
        201:
          description: "Successful Customer Creation"
          schema:
            $ref: "#/definitions/CustomerResponse"
          examples:
            application/json:
              id: 1
              first_name: "John"
              last_name: "Doe"
              email: "john.doe@email.com"
              phone: "555-1234"
              address: "123 Main St"
        400:
          description: "Invalid input"
          schema:
            $ref: "#/definitions/ErrorResponse"
        409:
          description: "Customer with this email already exists"
          schema:
            $ref: "#/definitions/ErrorResponse"

    get:
      tags:
        - Customers
      summary: "Returns all Customers"
      description: "Endpoint to retrieve a list of all customers."
      responses:
        200:
          description: "Retrieved Customers Successfully"
          schema:
            $ref: "#/definitions/AllCustomers"

    put:
      tags:
        - Customers
      summary: "Endpoint to update a customer."
      description: "Endpoint to update a customer, this is a token authenticated route, and the customer must be logged in to update their account."
      security:
        - bearerAuth: []
      parameters:
        - in: "body"
          name: "body"
          description: "Information required to update a Customer."
          required: true
          schema:
            $ref: "#/definitions/UpdateCustomerPayload"
      responses:
        200:
          description: "Successfully Updated customer"
          schema:
            $ref: "#/definitions/CustomerResponse"
          examples:
            application/json:
              id: 1
              first_name: "John"
              last_name: "Smith"
              email: "john.smith@email.com"
              phone: "555-5678"
              address: "456 Oak Ave"
        400:
          description: "Invalid input"
          schema:
            $ref: "#/definitions/ErrorResponse"
        401:
          description: "Unauthorized - Invalid or missing token"
          schema:
            $ref: "#/definitions/ErrorResponse"

    delete:
      tags:
        - Customers
      summary: "Endpoint to delete a customer"
      description: "Endpoint to delete a customer. Requires token authentication, customer must be logged in to delete their account"
      security:
        - bearerAuth: []
      responses:
        200:
          description: "Successfully Deleted customer"
          schema:
            $ref: "#/definitions/DeleteResponse"
          examples:
            application/json:
              message: "Customer successfully deleted"
        401:
          description: "Unauthorized - Invalid or missing token"
          schema:
            $ref: "#/definitions/ErrorResponse"
        404:
          description: "Customer not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

  /customers/{customer_id}:
    get:
      tags:
        - Customers
      summary: "Get a specific customer by ID"
      description: "Retrieve detailed information about a specific customer"
      parameters:
        - in: "path"
          name: "customer_id"
          type: "integer"
          required: true
          description: "ID of the customer to retrieve"
      responses:
        200:
          description: "Customer retrieved successfully"
          schema:
            $ref: "#/definitions/CustomerResponse"
        404:
          description: "Customer not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

  # Mechanic Endpoints
  /mechanics:
    post:
      tags:
        - Mechanics
      summary: "Create a new mechanic"
      description: "Add a new mechanic to the system"
      parameters:
        - in: "body"
          name: "body"
          description: "Mechanic information"
          required: true
          schema:
            $ref: "#/definitions/CreateMechanicPayload"
      responses:
        201:
          description: "Mechanic created successfully"
          schema:
            $ref: "#/definitions/MechanicResponse"
          examples:
            application/json:
              id: 1
              first_name: "Mike"
              last_name: "Smith"
              email: "mike.smith@mechanicshop.com"
              phone: "555-9876"
              specialty: "Engine Repair"
              hourly_rate: 85.50
        400:
          description: "Invalid input"
          schema:
            $ref: "#/definitions/ErrorResponse"
        409:
          description: "Mechanic with this email already exists"
          schema:
            $ref: "#/definitions/ErrorResponse"

    get:
      tags:
        - Mechanics
      summary: "Returns all Mechanics"
      description: "Endpoint to retrieve a list of all mechanics."
      responses:
        200:
          description: "Retrieved Mechanics Successfully"
          schema:
            $ref: "#/definitions/AllMechanics"

  /mechanics/{mechanic_id}:
    get:
      tags:
        - Mechanics
      summary: "Get a specific mechanic by ID"
      description: "Retrieve detailed information about a specific mechanic"
      parameters:
        - in: "path"
          name: "mechanic_id"
          type: "integer"
          required: true
          description: "ID of the mechanic to retrieve"
      responses:
        200:
          description: "Mechanic retrieved successfully"
          schema:
            $ref: "#/definitions/MechanicResponse"
        404:
          description: "Mechanic not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

    put:
      tags:
        - Mechanics
      summary: "Update a mechanic"
      description: "Update an existing mechanic's information"
      parameters:
        - in: "path"
          name: "mechanic_id"
          type: "integer"
          required: true
          description: "ID of the mechanic to update"
        - in: "body"
          name: "body"
          description: "Updated mechanic information"
          required: true
          schema:
            $ref: "#/definitions/UpdateMechanicPayload"
      responses:
        200:
          description: "Mechanic updated successfully"
          schema:
            $ref: "#/definitions/MechanicResponse"
        400:
          description: "Invalid input"
          schema:
            $ref: "#/definitions/ErrorResponse"
        404:
          description: "Mechanic not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

    delete:
      tags:
        - Mechanics
      summary: "Delete a mechanic"
      description: "Remove a mechanic from the system"
      parameters:
        - in: "path"
          name: "mechanic_id"
          type: "integer"
          required: true
          description: "ID of the mechanic to delete"
      responses:
        200:
          description: "Mechanic deleted successfully"
          schema:
            $ref: "#/definitions/DeleteResponse"
        404:
          description: "Mechanic not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

  # Service Ticket Endpoints
  /service-tickets:
    post:
      tags:
        - Service Tickets
      summary: "Create a new service ticket"
      description: "Create a new service ticket for a customer's vehicle"
      parameters:
        - in: "body"
          name: "body"
          description: "Service ticket information"
          required: true
          schema:
            $ref: "#/definitions/CreateServiceTicketPayload"
      responses:
        201:
          description: "Service ticket created successfully"
          schema:
            $ref: "#/definitions/ServiceTicketResponse"
          examples:
            application/json:
              id: 1
              customer_id: 1
              vehicle_year: 2020
              vehicle_make: "Toyota"
              vehicle_model: "Camry"
              vehicle_vin: "1HGBH41JXMN109186"
              description: "Oil change and tire rotation needed"
              estimated_cost: 150.00
              status: "Open"
        400:
          description: "Invalid input"
          schema:
            $ref: "#/definitions/ErrorResponse"
        404:
          description: "Customer not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

    get:
      tags:
        - Service Tickets
      summary: "Returns all Service Tickets"
      description: "Endpoint to retrieve a list of all service tickets."
      responses:
        200:
          description: "Retrieved Service Tickets Successfully"
          schema:
            $ref: "#/definitions/AllServiceTickets"

  /service-tickets/{ticket_id}:
    get:
      tags:
        - Service Tickets
      summary: "Get a specific service ticket by ID"
      description: "Retrieve detailed information about a specific service ticket"
      parameters:
        - in: "path"
          name: "ticket_id"
          type: "integer"
          required: true
          description: "ID of the service ticket to retrieve"
      responses:
        200:
          description: "Service ticket retrieved successfully"
          schema:
            $ref: "#/definitions/ServiceTicketResponse"
        404:
          description: "Service ticket not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

    put:
      tags:
        - Service Tickets
      summary: "Update a service ticket"
      description: "Update an existing service ticket's information"
      parameters:
        - in: "path"
          name: "ticket_id"
          type: "integer"
          required: true
          description: "ID of the service ticket to update"
        - in: "body"
          name: "body"
          description: "Updated service ticket information"
          required: true
          schema:
            $ref: "#/definitions/UpdateServiceTicketPayload"
      responses:
        200:
          description: "Service ticket updated successfully"
          schema:
            $ref: "#/definitions/ServiceTicketResponse"
        400:
          description: "Invalid input"
          schema:
            $ref: "#/definitions/ErrorResponse"
        404:
          description: "Service ticket not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

    delete:
      tags:
        - Service Tickets
      summary: "Delete a service ticket"
      description: "Remove a service ticket from the system"
      parameters:
        - in: "path"
          name: "ticket_id"
          type: "integer"
          required: true
          description: "ID of the service ticket to delete"
      responses:
        200:
          description: "Service ticket deleted successfully"
          schema:
            $ref: "#/definitions/DeleteResponse"
        404:
          description: "Service ticket not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

  /service-tickets/{ticket_id}/assign/{mechanic_id}:
    post:
      tags:
        - Service Tickets
      summary: "Assign a mechanic to a service ticket"
      description: "Assign a specific mechanic to work on a service ticket"
      parameters:
        - in: "path"
          name: "ticket_id"
          type: "integer"
          required: true
          description: "ID of the service ticket"
        - in: "path"
          name: "mechanic_id"
          type: "integer"
          required: true
          description: "ID of the mechanic to assign"
      responses:
        200:
          description: "Mechanic assigned successfully"
          schema:
            $ref: "#/definitions/ServiceTicketResponse"
        404:
          description: "Service ticket or mechanic not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

  /service-tickets/{ticket_id}/parts:
    post:
      tags:
        - Service Tickets
      summary: "Add multiple inventory parts to a service ticket"
      description: "Add multiple inventory parts to a service ticket in a single request"
      parameters:
        - in: "path"
          name: "ticket_id"
          type: "integer"
          required: true
          description: "ID of the service ticket"
        - in: "body"
          name: "body"
          description: "List of inventory part IDs to add"
          required: true
          schema:
            $ref: "#/definitions/AddMultiplePartsPayload"
      responses:
        200:
          description: "Parts added successfully"
          schema:
            $ref: "#/definitions/AddMultiplePartsResponse"
        400:
          description: "Invalid input data"
          schema:
            $ref: "#/definitions/ErrorResponse"
        404:
          description: "Service ticket or inventory part not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

  # Inventory Endpoints
  /inventory:
    post:
      tags:
        - Inventory
      summary: "Create a new inventory part"
      description: "Add a new part to the inventory system"
      parameters:
        - in: "body"
          name: "body"
          description: "Inventory part information"
          required: true
          schema:
            $ref: "#/definitions/CreateInventoryPayload"
      responses:
        201:
          description: "Inventory part created successfully"
          schema:
            $ref: "#/definitions/InventoryResponse"
          examples:
            application/json:
              id: 1
              name: "Oil Filter"
              price: 12.99
        400:
          description: "Invalid input"
          schema:
            $ref: "#/definitions/ErrorResponse"

    get:
      tags:
        - Inventory
      summary: "Returns all Inventory Parts"
      description: "Endpoint to retrieve a list of all inventory parts."
      responses:
        200:
          description: "Retrieved Inventory Parts Successfully"
          schema:
            $ref: "#/definitions/AllInventory"

  /inventory/{inventory_id}:
    get:
      tags:
        - Inventory
      summary: "Get a specific inventory part by ID"
      description: "Retrieve detailed information about a specific inventory part"
      parameters:
        - in: "path"
          name: "inventory_id"
          type: "integer"
          required: true
          description: "ID of the inventory part to retrieve"
      responses:
        200:
          description: "Inventory part retrieved successfully"
          schema:
            $ref: "#/definitions/InventoryResponse"
        404:
          description: "Inventory part not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

    put:
      tags:
        - Inventory
      summary: "Update an inventory part"
      description: "Update an existing inventory part's information"
      parameters:
        - in: "path"
          name: "inventory_id"
          type: "integer"
          required: true
          description: "ID of the inventory part to update"
        - in: "body"
          name: "body"
          description: "Updated inventory part information"
          required: true
          schema:
            $ref: "#/definitions/UpdateInventoryPayload"
      responses:
        200:
          description: "Inventory part updated successfully"
          schema:
            $ref: "#/definitions/InventoryResponse"
        400:
          description: "Invalid input"
          schema:
            $ref: "#/definitions/ErrorResponse"
        404:
          description: "Inventory part not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

    delete:
      tags:
        - Inventory
      summary: "Delete an inventory part"
      description: "Remove an inventory part from the system"
      parameters:
        - in: "path"
          name: "inventory_id"
          type: "integer"
          required: true
          description: "ID of the inventory part to delete"
      responses:
        200:
          description: "Inventory part deleted successfully"
          schema:
            $ref: "#/definitions/DeleteResponse"
        404:
          description: "Inventory part not found"
          schema:
            $ref: "#/definitions/ErrorResponse"

definitions:
  # Authentication Definitions
  LoginCredentials:
    type: "object"
    properties:
      email:
        type: "string"
        format: "email"
        example: "john.doe@email.com"
      password:
        type: "string"
        format: "password"
        example: "SecurePassword123"
    required:
      - email
      - password

  LoginResponse:
    type: "object"
    properties:
      message:
        type: "string"
        example: "Login successful"
      token:
        type: "string"
        example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      customer:
        type: "object"
        properties:
          id:
            type: "integer"
            example: 1
          first_name:
            type: "string"
            example: "John"
          last_name:
            type: "string"
            example: "Doe"
          email:
            type: "string"
            example: "john.doe@email.com"
          phone:
            type: "string"
            example: "555-1234"
          address:
            type: "string"
            example: "123 Main St"

  # Customer Definitions
  CreateCustomerPayload:
    type: "object"
    properties:
      first_name:
        type: "string"
        example: "John"
      last_name:
        type: "string"
        example: "Doe"
      email:
        type: "string"
        format: "email"
        example: "john.doe@email.com"
      phone:
        type: "string"
        example: "555-1234"
      address:
        type: "string"
        example: "123 Main St"
      password:
        type: "string"
        format: "password"
        example: "SecurePassword123"
    required:
      - first_name
      - last_name
      - email
      - password

  UpdateCustomerPayload:
    type: "object"
    properties:
      first_name:
        type: "string"
        example: "John"
      last_name:
        type: "string"
        example: "Smith"
      email:
        type: "string"
        format: "email"
        example: "john.smith@email.com"
      phone:
        type: "string"
        example: "555-5678"
      address:
        type: "string"
        example: "456 Oak Ave"
      password:
        type: "string"
        format: "password"
        example: "NewSecurePassword456"
    required:
      - first_name
      - last_name
      - email

  CustomerResponse:
    type: "object"
    properties:
      id:
        type: "integer"
        example: 1
      first_name:
        type: "string"
        example: "John"
      last_name:
        type: "string"
        example: "Doe"
      email:
        type: "string"
        example: "john.doe@email.com"
      phone:
        type: "string"
        example: "555-1234"
      address:
        type: "string"
        example: "123 Main St"

  AllCustomers:
    type: "array"
    items:
      type: "object"
      properties:
        id:
          type: "integer"
          example: 1
        first_name:
          type: "string"
          example: "John"
        last_name:
          type: "string"
          example: "Doe"
        email:
          type: "string"
          example: "john.doe@email.com"
        phone:
          type: "string"
          example: "555-1234"
        address:
          type: "string"
          example: "123 Main St"

  # Mechanic Definitions
  CreateMechanicPayload:
    type: "object"
    properties:
      first_name:
        type: "string"
        example: "Mike"
      last_name:
        type: "string"
        example: "Smith"
      email:
        type: "string"
        format: "email"
        example: "mike.smith@mechanicshop.com"
      phone:
        type: "string"
        example: "555-9876"
      specialty:
        type: "string"
        example: "Engine Repair"
      hourly_rate:
        type: "number"
        format: "float"
        example: 85.50
      hire_date:
        type: "string"
        format: "date"
        example: "2024-01-15"
    required:
      - first_name
      - last_name
      - email

  UpdateMechanicPayload:
    type: "object"
    properties:
      first_name:
        type: "string"
        example: "Mike"
      last_name:
        type: "string"
        example: "Johnson"
      email:
        type: "string"
        format: "email"
        example: "mike.johnson@mechanicshop.com"
      phone:
        type: "string"
        example: "555-4321"
      specialty:
        type: "string"
        example: "Transmission Repair"
      hourly_rate:
        type: "number"
        format: "float"
        example: 95.00
    required:
      - first_name
      - last_name
      - email

  MechanicResponse:
    type: "object"
    properties:
      id:
        type: "integer"
        example: 1
      first_name:
        type: "string"
        example: "Mike"
      last_name:
        type: "string"
        example: "Smith"
      email:
        type: "string"
        example: "mike.smith@mechanicshop.com"
      phone:
        type: "string"
        example: "555-9876"
      specialty:
        type: "string"
        example: "Engine Repair"
      hourly_rate:
        type: "number"
        example: 85.50

  AllMechanics:
    type: "array"
    items:
      type: "object"
      properties:
        id:
          type: "integer"
          example: 1
        first_name:
          type: "string"
          example: "Mike"
        last_name:
          type: "string"
          example: "Smith"
        email:
          type: "string"
          example: "mike.smith@mechanicshop.com"
        phone:
          type: "string"
          example: "555-9876"
        specialty:
          type: "string"
          example: "Engine Repair"
        hourly_rate:
          type: "number"
          example: 85.50

  # Service Ticket Definitions
  CreateServiceTicketPayload:
    type: "object"
    properties:
      customer_id:
        type: "integer"
        example: 1
      vehicle_year:
        type: "integer"
        example: 2020
      vehicle_make:
        type: "string"
        example: "Toyota"
      vehicle_model:
        type: "string"
        example: "Camry"
      vehicle_vin:
        type: "string"
        example: "1HGBH41JXMN109186"
      description:
        type: "string"
        example: "Oil change and tire rotation needed"
      estimated_cost:
        type: "number"
        format: "float"
        example: 150.00
      status:
        type: "string"
        example: "Open"
    required:
      - customer_id
      - description

  UpdateServiceTicketPayload:
    type: "object"
    properties:
      vehicle_year:
        type: "integer"
        example: 2020
      vehicle_make:
        type: "string"
        example: "Toyota"
      vehicle_model:
        type: "string"
        example: "Camry"
      vehicle_vin:
        type: "string"
        example: "1HGBH41JXMN109186"
      description:
        type: "string"
        example: "Oil change, tire rotation, and brake inspection"
      estimated_cost:
        type: "number"
        format: "float"
        example: 250.00
      actual_cost:
        type: "number"
        format: "float"
        example: 245.50
      status:
        type: "string"
        example: "In Progress"

  ServiceTicketResponse:
    type: "object"
    properties:
      id:
        type: "integer"
        example: 1
      customer_id:
        type: "integer"
        example: 1
      vehicle_year:
        type: "integer"
        example: 2020
      vehicle_make:
        type: "string"
        example: "Toyota"
      vehicle_model:
        type: "string"
        example: "Camry"
      vehicle_vin:
        type: "string"
        example: "1HGBH41JXMN109186"
      description:
        type: "string"
        example: "Oil change and tire rotation needed"
      estimated_cost:
        type: "number"
        example: 150.00
      actual_cost:
        type: "number"
        example: 145.00
      status:
        type: "string"
        example: "Open"
      created_at:
        type: "string"
        format: "date-time"
        example: "2023-01-15T10:30:00Z"
      completed_at:
        type: "string"
        format: "date-time"
        example: null
      customer:
        $ref: "#/definitions/CustomerResponse"
      mechanics:
        type: "array"
        items:
          $ref: "#/definitions/MechanicResponse"
      inventory_parts:
        type: "array"
        items:
          $ref: "#/definitions/InventoryResponse"

  AllServiceTickets:
    type: "array"
    items:
      $ref: "#/definitions/ServiceTicketResponse"

  # Inventory Definitions
  CreateInventoryPayload:
    type: "object"
    properties:
      name:
        type: "string"
        example: "Oil Filter"
      price:
        type: "number"
        format: "float"
        example: 12.99
    required:
      - name
      - price

  UpdateInventoryPayload:
    type: "object"
    properties:
      name:
        type: "string"
        example: "Premium Oil Filter"
      price:
        type: "number"
        format: "float"
        example: 15.99
    required:
      - name
      - price

  InventoryResponse:
    type: "object"
    properties:
      id:
        type: "integer"
        example: 1
      name:
        type: "string"
        example: "Oil Filter"
      price:
        type: "number"
        example: 12.99

  AllInventory:
    type: "array"
    items:
      type: "object"
      properties:
        id:
          type: "integer"
          example: 1
        name:
          type: "string"
          example: "Oil Filter"
        price:
          type: "number"
          example: 12.99

  # General Definitions
  DeleteResponse:
    type: "object"
    properties:
      message:
        type: "string"
        example: "Successfully deleted"

  AddMultiplePartsPayload:
    type: "object"
    required:
      - inventory_ids
    properties:
      inventory_ids:
        type: "array"
        items:
          type: "integer"
        example: [1, 2, 3]
        description: "List of inventory part IDs to add to the service ticket"

  AddMultiplePartsResponse:
    type: "object"
    properties:
      message:
        type: "string"
        example: "Added 2 parts to ticket 1"
      added_parts:
        type: "array"
        items:
          type: "integer"
        example: [1, 2]
      already_added:
        type: "array"
        items:
          type: "integer"
        example: []

  ErrorResponse:
    type: "object"
    properties:
      error:
        type: "string"
        example: "An error occurred"
      errors:
        type: "object"
